#!/bin/bash

set -e

QOS_BIN=$(realpath ${BASH_SOURCE})
QOS_DIR=$(realpath $(dirname ${QOS_BIN}))
ENV_FILE=${QOS_DIR}/.env
SCRIPT_DIR=$QOS_DIR/_script

source ${QOS_DIR}/_script/funcs.sh
source ${QOS_DIR}/_script/config.sh
source ${QOS_DIR}/_script/menu.sh

declare -A MENU_TREE=(
    [root]="config apps"
    [config]="settings show"
    [apps]="ax25 ax25d"
)

declare -A MENU_DESC=(
    [config]="Configuration commands"
    [config/show]="Show current .env file"
    [config/settings]="Edit settings like Callsign, SSID"
    [apps]="Application-specific commands"
    [apps/ax25]="Configure AX.25"
    [apps/ax25d]="Configure AX.25 daemon"
)

main() {
    dependencies
    generate_menu "qos" "$@"
}


config() {
    generate_menu "qos config" "$@"
}

apps() {
    generate_menu "qos apps" "$@"
}

config_show() {
    cat "$(realpath "$ENV_FILE")"
}

# config_ax25() {
#     wizard menu "QOS ax25" \
#            "settings (Callsign) = ${BASH_SOURCE} config" \
#            "pair (BTECH UV-PRO and clones) = ${BASH_SOURCE} pair || true" \
#            "enable (rfcomm KISS service) = ${BASH_SOURCE} configure_rfcomm_service" \
#            "check (AX.25 connection) = ${BASH_SOURCE} check_rfcomm_kiss"
# }

# config_ax25d() {
#     wizard menu "ax25d" \
#            "ax25d enable = ${BASH_SOURCE} configure_ax25d_service" \
#            "ax25d status = podman exec ax25d systemctl status ax25d || true" \
#            "ax25d logs = ${QOS_DIR}/ax25d/logs.sh || true" \
#            "ax25d disable = podman exec ax25d systemctl poweroff; systemctl disable --now ax25d.service ; podman rm -f ax25d" \
#            "ax25d shell = podman exec -it ax25d /bin/bash || true"
# }

main "$@"
